<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>blblm Package Improvements</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">blblm Package Improvements</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(blblm)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(future)</a></code></pre></div>
<p>The new package named <code>blblm</code> is to fit regression models with a bag of little bootstrap.</p>
<div id="bag-of-little-bootstrap" class="section level2">
<h2>Bag of Little Bootstrap</h2>
<p>The BLB is a combinied method of bootstrap with replacement and subsample. We will first map the data into s subsamples without replacement. And each subsample’s size is b. Then, within each subsample, BLB will bootstrap r times into each bootstrap sample with size n. The bootstrap statistics can be computed. After that, we can find the the statistics from the bootstrap statistics and take average of it.</p>
<p>Thus, we can see that BLB can improve the computationally efficiency and also make sure the quality of estimates. It also provides a method of pre-aggregating data before bootstrapping to reduce computational constraints.</p>
</div>
<div id="blblm-package" class="section level2">
<h2>blblm package</h2>
<p>In the <code>blblm</code> package, we use the bag of little bootstrap to run two different regression models, which are linear regression, <code>blblm()</code>, and logistic regression, <code>blblog()</code>.</p>
<div id="blblm" class="section level3">
<h3>blblm()</h3>
<p>The <code>blblm()</code> function can fit linear regression model on the data by BLB. This will require the users to input 4 parameters. Those are</p>
<ul>
<li><p><code>formula</code>, the formula of the linear regression</p></li>
<li><p><code>data</code>, the data you want to fit the model</p></li>
<li><p><code>m</code>, the integer indicating the number of subsamples</p></li>
<li><p><code>B</code>, the integer indicating the number of bootstrap</p></li>
<li><p><code>parallel</code>, the boolean to run the function wheter use paralleization or not. Its default value is <code>FALSE</code>.</p></li>
</ul>
<p>Note that when choosing <code>parallel = TRUE</code>, the users need to have <code>plan(multisession, workers = 4)</code> to specify the number of workers they need. In this case, I chose 4 clsuters, but users can change this numer as their need.</p>
<p>Then, the <code>blblm()</code> will return the fitted linear regression model. The user could further find the estimators’ confidence interval, standard error, prediction interval and so on.</p>
<p>Here is an example of the <code>blblm()</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">fit1 &lt;-<span class="st"> </span><span class="kw">blblm</span>(mpg <span class="op">~</span><span class="st"> </span>wt <span class="op">*</span><span class="st"> </span>hp, <span class="dt">data =</span> mtcars, <span class="dt">m =</span> <span class="dv">3</span>, <span class="dt">B =</span> <span class="dv">100</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">coef</span>(fit1)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#&gt; (Intercept)          wt          hp       wt:hp </span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt; 41.86577931 -5.55422581 -0.08075255  0.01508193</span></a></code></pre></div>
<p>We can find the estimated coefficient for the linear regression.</p>
<p>Also, we can find the confidence interval (default is 95% confidence) of the estimates, the standard error, the confidence interval of standard error, and the prediction interval.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">confint</span>(fit1, <span class="kw">c</span>(<span class="st">&quot;wt&quot;</span>, <span class="st">&quot;hp&quot;</span>))</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co">#&gt;          2.5%       97.5%</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">#&gt; wt -7.7945137 -3.20863813</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#&gt; hp -0.1522348 -0.02259588</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">sigma</span>(fit1)</a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">#&gt; [1] 1.761177</span></a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="kw">sigma</span>(fit1, <span class="dt">confidence =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">#&gt;    sigma      lwr      upr </span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co">#&gt; 1.761177 1.162230 2.246904</span></a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="kw">predict</span>(fit1, <span class="kw">data.frame</span>(<span class="dt">wt =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="dv">3</span>), <span class="dt">hp =</span> <span class="kw">c</span>(<span class="dv">150</span>, <span class="dv">170</span>)))</a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">#&gt;        1        2 </span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">#&gt; 21.52305 19.16695</span></a>
<a class="sourceLine" id="cb3-16" title="16"></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="kw">predict</span>(fit1, <span class="kw">data.frame</span>(<span class="dt">wt =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="dv">3</span>), <span class="dt">hp =</span> <span class="kw">c</span>(<span class="dv">150</span>, <span class="dv">170</span>)), <span class="dt">confidence =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">#&gt;     object      lwr      upr</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">#&gt; 1 21.52305 19.86989 22.77035</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">#&gt; 2 19.16695 17.28483 20.51708</span></a></code></pre></div>
<p>In order to show the improved efficiency by the parallezitation method, let’s benchmark the blblm in one CPU and in four CPUs. You can notice that the running time when running <code>parallel = TRUE</code> is almost half shorter than that of <code>parallel = FALSE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">suppressWarnings</span>(<span class="kw">plan</span>(multiprocess, <span class="dt">workers =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">bench<span class="op">::</span><span class="kw">mark</span>(<span class="dt">blblm.par =</span> {<span class="kw">blblm</span>(mpg <span class="op">~</span><span class="st"> </span>wt <span class="op">*</span><span class="st"> </span>hp, <span class="dt">data =</span> mtcars, <span class="dt">m =</span> <span class="dv">3</span>, <span class="dt">B =</span> <span class="dv">100</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)}, </a>
<a class="sourceLine" id="cb4-4" title="4">            <span class="dt">blblm.nonpar =</span> {<span class="kw">blblm</span>(mpg <span class="op">~</span><span class="st"> </span>wt <span class="op">*</span><span class="st"> </span>hp, <span class="dt">data =</span> mtcars, <span class="dt">m =</span> <span class="dv">3</span>, <span class="dt">B =</span> <span class="dv">100</span>, <span class="dt">parallel =</span> <span class="ot">TRUE</span>)}, </a>
<a class="sourceLine" id="cb4-5" title="5">            <span class="dt">check =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt; Warning: Some expressions had a GC in every iteration; so filtering is disabled.</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt; # A tibble: 2 x 6</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt;   expression        min   median `itr/sec` mem_alloc `gc/sec`</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt;   &lt;bch:expr&gt;   &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; 1 blblm.par       524ms    524ms      1.91     1.1MB     3.81</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt; 2 blblm.nonpar    258ms    277ms      3.61    3.65MB     0</span></a></code></pre></div>
</div>
<div id="blblog" class="section level3">
<h3>blblog()</h3>
<p>The <code>blblog()</code> function can fit logistic regression model on the data by BLB. This will also require the users to input 4 parameters. Those are</p>
<ul>
<li><p><code>formula</code>, the formula of the logistic regression</p></li>
<li><p><code>data</code>, the data you want to fit the model</p></li>
<li><p><code>m</code>, the integer indicating the number of subsamples</p></li>
<li><p><code>B</code>, the integer indicating the number of bootstrap</p></li>
<li><p><code>parallel</code>, the boolean to run the function wheter use paralleization or not. Its default value is <code>FALSE</code>.</p></li>
</ul>
<p>Note that when choosing <code>parallel = TRUE</code>, the users need to have <code>plan(multisession, workers = 4)</code> to specify the number of workers they need. In this case, I chose 4 clsuters, but users can change this numer as their need.</p>
<p>Then, the <code>blblog()</code> will return the fitted logistic regression model. The user could further find the estimators’ confidence interval, standard error, prediction interval and so on.</p>
<p>Here is an example of the <code>blblog()</code></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">bi &lt;-<span class="st"> </span><span class="kw">sample</span>(iris[<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,], <span class="dv">1000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">fit2 &lt;-<span class="st"> </span><span class="kw">blblog</span>(Species <span class="op">~</span><span class="st"> </span>Sepal.Width <span class="op">+</span><span class="st"> </span>Sepal.Length, <span class="dt">data =</span> bi, <span class="dt">m =</span> <span class="dv">3</span>, <span class="dt">B =</span> <span class="dv">100</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">coef</span>(fit2)</a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt;  (Intercept)  Sepal.Width Sepal.Length </span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;   -188.84917    -81.48968     83.01358</span></a></code></pre></div>
<p>We can find the estimated coefficient for the logistic regression.</p>
<p>In order to show the improved efficiency by the parallezitation method, let’s benchmark the blblm in one CPU and in four CPUs. You can notice that the running time when <code>parallel = TRUE</code> is shorter.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">suppressWarnings</span>(<span class="kw">plan</span>(multiprocess, <span class="dt">workers =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3">bench<span class="op">::</span><span class="kw">mark</span>(<span class="dt">blblog.par =</span> {<span class="kw">blblog</span>(Species <span class="op">~</span><span class="st"> </span>Sepal.Width <span class="op">+</span><span class="st"> </span>Sepal.Length, <span class="dt">data =</span> bi, <span class="dt">m =</span> <span class="dv">3</span>, <span class="dt">B =</span> <span class="dv">100</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>)}, </a>
<a class="sourceLine" id="cb6-4" title="4">            <span class="dt">blblog.nonpar =</span> {<span class="kw">blblog</span>(Species <span class="op">~</span><span class="st"> </span>Sepal.Width <span class="op">+</span><span class="st"> </span>Sepal.Length, <span class="dt">data =</span> bi, <span class="dt">m =</span> <span class="dv">3</span>, <span class="dt">B =</span> <span class="dv">100</span>, <span class="dt">parallel =</span> <span class="ot">TRUE</span>)}, </a>
<a class="sourceLine" id="cb6-5" title="5">            <span class="dt">check =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; # A tibble: 2 x 6</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt;   expression         min   median `itr/sec` mem_alloc `gc/sec`</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt;   &lt;bch:expr&gt;    &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; 1 blblog.par          2s       2s     0.501   106.9MB    1.00 </span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; 2 blblog.nonpar    1.25s    1.25s     0.803     2.8MB    0.803</span></a></code></pre></div>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Overall, to improve the efficiency of <code>blblm</code> package, I conducted two improvements. First, I added the logistic regression model so that users can fit the data into more models. Second, I added the parallelization feature for both models. Users can specify whether they want to use parallelization. Third, I tried to work on the feature which allow users to specify the list of files they want to fit the model; however, I was not getting it done to submit this project on time. I attached the code as a reference to show my work.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">blblm &lt;-<span class="st"> </span><span class="cf">function</span>(formula, data, <span class="dt">m =</span> <span class="dv">10</span>, <span class="dt">B =</span> <span class="dv">5000</span>, <span class="dt">parallel =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb7-2" title="2">  data_list &lt;-<span class="st"> </span><span class="kw">split_data</span>(data, m)</a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="cf">if</span> (parallel <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb7-5" title="5">    map.func &lt;-<span class="st"> </span>future_map</a>
<a class="sourceLine" id="cb7-6" title="6">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb7-7" title="7">    map.func &lt;-<span class="st"> </span>map</a>
<a class="sourceLine" id="cb7-8" title="8">  }</a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11">  <span class="kw">dir.create</span>(<span class="st">&quot;files&quot;</span>, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-12" title="12">  <span class="dv">1</span><span class="op">:</span><span class="dv">100</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">walk</span>(<span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb7-13" title="13">    dt &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">5000</span>), <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">5000</span>))</a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="kw">write_csv</span>(dt, <span class="kw">file.path</span>(<span class="st">&quot;files&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;file%02d.csv&quot;</span>, i)))</a>
<a class="sourceLine" id="cb7-15" title="15">  })</a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">  file_names &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="st">&quot;files&quot;</span>, <span class="kw">list.files</span>(<span class="st">&quot;files&quot;</span>))</a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19">  estimates &lt;-<span class="st"> </span>data_list <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map.func</span>(<span class="op">~</span>{</a>
<a class="sourceLine" id="cb7-20" title="20">    df &lt;-<span class="st"> </span><span class="kw">vroom</span>(., <span class="dt">col_types=</span><span class="kw">cols</span>())</a>
<a class="sourceLine" id="cb7-21" title="21">    <span class="kw">lm_each_subsample</span>(<span class="dt">formula =</span> formula, <span class="dt">data =</span> ., <span class="dt">n =</span> <span class="kw">nrow</span>(data), <span class="dt">B =</span> B)</a>
<a class="sourceLine" id="cb7-22" title="22">  })</a>
<a class="sourceLine" id="cb7-23" title="23"></a>
<a class="sourceLine" id="cb7-24" title="24">  <span class="co"># estimates &lt;- map.func(</span></a>
<a class="sourceLine" id="cb7-25" title="25">  <span class="co">#   file_names,</span></a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="co">#   ~ lm_each_subsample(formula = formula, data = ., n = nrow(data), B = B))</span></a>
<a class="sourceLine" id="cb7-27" title="27">  res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">estimates =</span> estimates, <span class="dt">formula =</span> formula)</a>
<a class="sourceLine" id="cb7-28" title="28">  <span class="kw">class</span>(res) &lt;-<span class="st"> &quot;blblm&quot;</span></a>
<a class="sourceLine" id="cb7-29" title="29">  <span class="kw">invisible</span>(res)</a>
<a class="sourceLine" id="cb7-30" title="30">}</a></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
